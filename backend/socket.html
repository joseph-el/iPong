<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chat Gateway Test</title>
  </head>
  <body>
    <h1>Chat Gateway Test</h1>
    <div>
      <h2>Actions</h2>
      <button id="createRoomBtn">Create Room</button>
      <button id="joinRoomBtn">Join Room</button>
      <button id="sendMessageBtn">Send Message</button>
    </div>
    <div>
      <h2>Logs</h2>
      <pre id="logs"></pre>
    </div>

    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
    <script>
      
      const logs = document.getElementById('logs');
      const socket = io('http://localhost:3000/chat', {
        transports: ['websocket'],
        auth: {
          token:
            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6Im1tb3VuYWppQHN0dWRlbnQuMTMzNy5tYSIsInVzZXJJZCI6IjFkNGM4YzBlLThhNWMtNDdlMy1hZTM2LWRiM2QzNGMyNDA4ZCIsImlhdCI6MTcxODQ3MjIzOSwiZXhwIjoxNzE4NDc5NDM5fQ.dkEFqbep3NfCsa001ciN7TNdBSF2qziXtAxpFj8Wpa4',
        },
        reconnection: true,
        reconnectionAttempts: Infinity,
        reconnectionDelay: 1000,
        reconnectionDelayMax: 5000,
      });

      socket.on('connect', () => {
        log('Connected to WebSocket server');
      });

      socket.on('onlineFriends', (friendIds) => {
        log('Online Friends: ' + JSON.stringify(friendIds));
      });

      socket.on('joinRoom', (userId) => {
        log('Friend Online: ' + userId);
      });

      socket.on('friendOffline', (userId) => {
        log('Friend Offline: ' + userId);
      });

      socket.on('roomCreated', (room) => {
        log('Room Created: ' + JSON.stringify(room));
      });

      socket.on('message', (message) => {
        log('Message: ' + JSON.stringify(message));
      });

      socket.on('error', (error) => {
        log('Error: ' + JSON.stringify(error));
      });

      document.getElementById('createRoomBtn').addEventListener('click', () => {
        const data = {
          type: 'public', // or 'protected' with a password field
          name: 'Test Room',
        };
        socket.emit('createRoom', data);
      });

      document.getElementById('joinRoomBtn').addEventListener('click', () => {
        const data = {
          roomId: 'b5a85f58-6754-4b07-a36c-f48232ac2077', // Replace with a valid room ID
          memberId: '1d4c8c0e-8a5c-47e3-ae36-db3d34c2408d', // Replace with a valid member ID
        };
        log('Emitting joinRoom with data: ' + JSON.stringify(data));
        socket.emit('joinRoom', data);
      });

      document
        .getElementById('sendMessageBtn')
        .addEventListener('click', () => {
          const message = {
            roomId: 'ROOM_ID', // Replace with a valid room ID
            content: 'Hello, World!',
            senderId: 'SENDER_ID', // Replace with a valid sender ID
          };
          socket.emit('sendMessages', message);
        });

      function log(message) {
        logs.textContent += message + '\n';
      }
    </script>
  </body>
</html>
